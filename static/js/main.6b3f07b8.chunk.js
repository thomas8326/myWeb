(this["webpackJsonpthomas-web"]=this["webpackJsonpthomas-web"]||[]).push([[0],{133:function(e,t,n){},134:function(e,t,n){"use strict";n.r(t);var c,a=n(1),r=n(0),o=n(22),i=(n(93),n(4)),s=n(18),u=n(76),l=n(35),j=n(5),d=n(8),b=n(29),O=n.n(b);!function(e){e.Room="/api/rooms",e.Login="/api/login"}(c||(c={}));var m=c,f=n(3),v=function e(t){Object(f.a)(this,e),this.id=void 0,this.name=void 0,this.name=null!==t&&void 0!==t?t:null},x=n(20),h="LOGIN_USER",p={id:"",name:""};var g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case h:return Object(x.a)(Object(x.a)({},e),t.object);default:return e}};var N=function(){var e=Object(r.useState)(""),t=Object(d.a)(e,2),n=t[0],c=t[1],o=Object(r.useState)(""),s=Object(d.a)(o,2),u=s[0],l=s[1],b=Object(i.b)(),f=Object(j.f)(),x=function(){var e=new v(n);O.a.post(m.Login,e).then((function(e){var t;b((t=e.data.data,{type:h,payload:[],object:t}))})),f.push("/show-room")};return Object(a.jsx)("div",{className:"full-layout flex-col flex-center",children:Object(a.jsxs)("div",{className:"flex-col flex-center login",children:[Object(a.jsx)("input",{type:"text",className:"input-box input-l",placeholder:"Username",value:n,onInput:function(e){return c(e.currentTarget.value)}}),Object(a.jsx)("input",{type:"text",className:"input-box input-l",placeholder:"Password",value:u,onInput:function(e){return l(e.currentTarget.value)}}),Object(a.jsx)("input",{type:"submit",className:"input-s",value:"submit",onClick:function(){return x()}})]})})};var y=function(){return Object(a.jsxs)("div",{className:"round",children:[Object(a.jsx)("div",{className:"bg-red"}),Object(a.jsx)("span",{children:"Name"})]})};var I=function(e){var t=e.title;return Object(a.jsxs)("div",{className:"flex-row padding-m shadow-card",children:[Object(a.jsx)(y,{}),Object(a.jsxs)("div",{children:[Object(a.jsx)("image",{}),t]})]})},C=n(143);var S=function(e){var t=e.onBackClick,n=e.title;return Object(a.jsxs)("div",{className:"flex-row flex-align-center padding-m",children:[Object(a.jsx)(C.a,{onClick:function(){return t()}}),Object(a.jsx)("span",{className:"margin-center title-3",children:n})]})},w=n(14),k=n.n(w);var E=function(e){var t=e.isMine,n=e.message;return Object(a.jsx)("div",{className:k()("bubble",{"mine-bubble":t,"other-bubble":!t}),children:Object(a.jsxs)("div",{className:"flex-row flex-align-center",children:[Object(a.jsx)("div",{className:"message-text",children:n.content}),Object(a.jsx)("div",{className:"message-time",children:n.date})]})})};var _=function(e){var t=e.roomId,n=Object(i.c)((function(e){return e.userInfo})),c=Object(i.c)((function(e){return e.conversation[t]}));return Object(a.jsx)("div",{className:"conversation flex-1 flex-col",children:Object(a.jsx)("div",{className:"full-layout",children:null===c||void 0===c?void 0:c.map((function(e){return Object(a.jsx)(E,{isMine:n.id===e.senderId,message:e})}))})})},T=n(144),R=n(141),M=n(139),D=n(142),A=n(36),W=new function e(){Object(f.a)(this,e)},B="RECEIVE_MESSAGE";var G=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:W,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case B:var n=e;return Object.keys(t.object).forEach((function(e){var c;n[e]=(null!==(c=n[e])&&void 0!==c?c:[]).concat(t.object[e])})),n;default:return e}},L="SEND_MESSAGE",J="STOMP_CONNECT_ROOM",U="STOMP_DISCONNECT_ROOM";var F=function(e){var t;return function(n){return function(c){switch(c.type){case"WS_CONNECT":(t=M.a.over((function(){return new WebSocket("ws://localhost:8080/chat")}))).connect(c.object,(function(){t.subscribe("/user/queue/subscribe",(function(t){return e.dispatch(function(e){var t=Object(A.a)({},e.roomId,[e]);return{type:B,payload:[],object:t}}(JSON.parse(t.body)))}))}));break;case"WS_DISCONNECT":Object(D.a)(t)||t.disconnect();break;case J:break;case U:t.unsubscribe("".concat("/chat/room","/").concat(c.object.roomId));break;case L:var a={msgId:c.object.msgId,content:c.object.content,roomId:c.object.roomId,senderId:c.object.senderId};t.send("/chat/room/".concat(a.roomId),{},JSON.stringify(a))}return n(c)}}},P=function(e){return function(t){"Enter"===t.key&&e()}};var H=function(e){var t=e.senderId,n=e.roomId,c=Object(r.useState)(""),o=Object(d.a)(c,2),s=o[0],u=o[1],l=Object(i.b)(),j=function(){""!==s&&(l(function(e,t,n){return{type:L,payload:[],object:{msgId:Object(R.a)(),roomId:e,content:t,senderId:n}}}(n,s,t)),u(""))},b=P(j);return Object(a.jsxs)("div",{className:"flex-row sender-box flex-align-center padding-m",children:[Object(a.jsx)("input",{type:"text",value:s,className:"flex-1",onInput:function(e){return u(e.currentTarget.value)},onKeyUp:function(e){return b(e)}}),Object(a.jsx)(T.a,{className:"icon-m padding-m",onClick:function(){return j()}})]})},K=function e(t,n){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];Object(f.a)(this,e),this.id=void 0,this.name=void 0,this.participants=[],this.messages=[],this.id=null!==t&&void 0!==t?t:"",this.name=null!==n&&void 0!==n?n:"",this.participants=c,this.messages=a};var q=function(e){var t,n,c=Object(i.c)((function(t){var n;return null!==(n=t.rooms.find((function(t){return t.id===e.roomId})))&&void 0!==n?n:new K})),o=Object(i.c)((function(e){return e.userInfo})),s=Object(i.b)();return Object(r.useEffect)((function(){var t;return s((t=e.roomId,{type:J,payload:[],object:{roomId:t}})),function(){s(function(e){return{type:U,payload:[],object:{roomId:e}}}(e.roomId))}}),[]),Object(a.jsxs)("div",{className:"full-layout flex-col",children:[Object(a.jsx)(S,{onBackClick:function(){return e.onBackClick("")},title:c.name}),Object(a.jsx)(_,{roomId:null!==(t=c.id)&&void 0!==t?t:""}),Object(a.jsx)(H,{roomId:null!==(n=null===c||void 0===c?void 0:c.id)&&void 0!==n?n:"",senderId:o.id})]})},V=n(145),z=n(146),Q=n(147),X=n(148),Y=n(32),Z="CREATE_CHAT_ROOM",$="GET_CHAT_ROOMS",ee="ADD_ROOM_USER",te="SET_ROOM_MESSAGE";var ne=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Z:return[].concat(Object(Y.a)(e),Object(Y.a)(t.payload));case $:return t.payload;case ee:case te:var n=e.map((function(e){return e.id===t.object.id?t.object:e}));return n;default:return e}},ce=function(){var e=Object(r.useState)(!1),t=Object(d.a)(e,2),n=t[0],c=t[1],o=Object(r.useState)(""),s=Object(d.a)(o,2),u=s[0],l=s[1],j=Object(i.b)(),b=function(){j(function(e){return{type:Z,payload:[{id:Object(R.a)(),roomName:e}]}}(u)),c(!1),l("")};return n?Object(a.jsxs)("div",{className:"flex-row flex-align-center shadow-card",children:[Object(a.jsx)(V.a,{className:"icon-l R-margin-m padding-m"}),Object(a.jsx)("input",{className:"input-box input-f",value:u,onInput:function(e){return l(e.currentTarget.value)}}),Object(a.jsx)(z.a,{className:"primary icon-m L-margin-m",onClick:function(){return b()}}),Object(a.jsx)(Q.a,{className:"primary icon-m L-margin-m",onClick:function(){return c(!1)}})]}):Object(a.jsxs)("button",{type:"button",className:"flex-row flex-align-center shadow-card",onClick:function(){return c(!0)},children:[Object(a.jsx)(X.a,{className:"primary icon-l padding-m"}),Object(a.jsx)("span",{children:"Create New Chatroom"})]})},ae=n(149),re=function(e){var t=e.room;return Object(a.jsxs)("div",{className:"flex-row flex-align-center shadow-card",children:[Object(a.jsx)(ae.a,{className:"padding-m icon-l"}),Object(a.jsx)("div",{children:t.name})]})};var oe=function(e){var t=Object(r.useState)([]),n=Object(d.a)(t,2),c=n[0],o=n[1],s=Object(i.b)();Object(r.useEffect)((function(){O.a.get("/api/rooms").then((function(e){s(function(e){return{type:$,payload:e}}(e.data.data)),o(e.data.data)}))}),[]);var u=Object(i.c)((function(e){return e.userInfo})),l=function(t){O.a.patch("".concat(m.Room,"/").concat(t.id),u).then((function(n){s(function(e,t){var n=e.participants.concat(t),c=Object(x.a)(Object(x.a)({},e),{participants:n});return{type:ee,payload:[],object:c}}(t,n.data.data.participants)),e.onClick(t.id)}))};return Object(a.jsxs)("div",{className:"list",children:[c.map((function(e){return Object(a.jsx)("div",{role:"button",tabIndex:0,className:"B-margin-m",onClick:function(){return l(e)},onKeyDown:function(){},children:Object(a.jsx)(re,{room:e})},e.id)})),Object(a.jsx)(ce,{})]})},ie=n(140);var se=function(e){var t=e.userId,n=Object(r.useState)(""),c=Object(d.a)(n,2),o=c[0],s=c[1],u=Object(r.useState)(!1),l=Object(d.a)(u,2),j=l[0],b=l[1],O=Object(i.b)();return Object(r.useEffect)((function(){return t&&O(function(e){return{type:"WS_CONNECT",object:{id:e,name:""},payload:[]}}(t)),function(){O({type:"WS_DISCONNECT"})}}),[t]),Object(a.jsxs)("div",{children:[Object(a.jsx)("button",{type:"button","aria-label":"mute",className:"icon-messenger icon-m",onClick:function(){return b(!0)}}),Object(a.jsx)("div",{className:"flex-row",children:Object(a.jsx)(ie.a,{width:"400px",placement:"right",visible:j,onClose:function(){return b(!1)},closable:!1,maskStyle:{backgroundColor:"transparent"},destroyOnClose:!0,children:Object(a.jsx)("div",{className:"message-content",children:""===o?Object(a.jsx)(oe,{onClick:function(e){return s(e)}}):Object(a.jsx)(q,{roomId:o,onBackClick:function(){return s("")}})})})})]})};var ue=function(e){var t=Object(i.c)((function(e){return e.userInfo})),n=e.title;return Object(a.jsx)(a.Fragment,{children:Object(a.jsxs)("header",{className:"global-header",children:[Object(a.jsx)("div",{children:"---"}),Object(a.jsx)("span",{children:n}),Object(a.jsx)(se,{userId:t.id})]})})};var le=function(){return Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(ue,{title:"Show Room"}),Object(a.jsx)("main",{className:"full-layout flex-col ",children:Object(a.jsx)(I,{title:"123"})})]})};n(133);var je=function(){return Object(a.jsx)(a.Fragment,{children:Object(a.jsxs)(j.c,{children:[Object(a.jsx)(j.a,{exact:!0,path:"/",children:Object(a.jsx)(N,{})}),Object(a.jsx)(j.a,{path:"/show-room",children:Object(a.jsx)(le,{})})]})})},de=n(85),be=Object(s.combineReducers)({userInfo:g,rooms:ne,conversation:G}),Oe=Object(s.createStore)(be,Object(de.composeWithDevTools)(Object(s.applyMiddleware)(u.a,F)));Object(o.render)(Object(a.jsx)(i.a,{store:Oe,children:Object(a.jsx)(l.a,{basename:"/myWeb",children:Object(a.jsx)(je,{})})}),document.getElementById("root"))},93:function(e,t,n){}},[[134,1,2]]]);
//# sourceMappingURL=main.6b3f07b8.chunk.js.map